
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subviews and Filters &#8212; pynbody 1.0.0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tracing Particles between Snapshots" href="bridge.html" />
    <link rel="prev" title="A walk through pynbody’s low-level facilities" href="data_access.html" />

   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

<link href="https://fonts.googleapis.com/css?family=Quicksand" rel="stylesheet">
<link href="_static/customise.css" rel="stylesheet">
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-38063425-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="subviews-and-filters">
<h1>Subviews and Filters<a class="headerlink" href="#subviews-and-filters" title="Permalink to this headline">¶</a></h1>
<p>Analyzing simulations often boils down to comparing properties of
groups of particles or sections of the simulated volume. Therefore a
generic task in analysis routines is to search for indices of
particles (or cells) corresponding to some interesting property, so
analysis code often looks something like this:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sim</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">group_id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">sim</span><span class="p">[</span><span class="s2">&quot;mass&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span><span class="o">*</span><span class="n">sim</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example, we obtained the center of mass of some group
specified by <cite>group_id</cite>. Such patterns are fine, but they are ugly to
look at and illegible when written out in long complicated chains.</p>
<p>For this reason, <cite>pynbody</cite> has the concept of sub-views of
simulations. Subviews behave exactly like a full simulation, but they
reference only a subset of the data of that full simulation.</p>
<p>This makes writing code which processes individual halos trivial; for
instance</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">sim</span><span class="p">[</span><span class="s2">&quot;mass&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">sim</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>will find the centre of mass of whatever you throw at it. So if we had
some way of defining a <em>sub-view</em> of the whole simulation that refers
to just the halo that we want, called <cite>halo</cite>, then we could do
something like</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">halo</span><span class="p">[</span><span class="s2">&quot;mass&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">halo</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>The indexing is taken care of under the hood and all the boilerplate
indexing code is gone. In this tutorial, we discuss some of the ways
that subviews and filters can be used in <cite>pynbody</cite>.</p>
<div class="section" id="how-do-i-create-a-simple-subview">
<h2>How do I create a simple subview?<a class="headerlink" href="#how-do-i-create-a-simple-subview" title="Permalink to this headline">¶</a></h2>
<p>Quite simply, indexing or slicing operations commute with array-fetch
operations, i.e.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">subsim</span> <span class="o">=</span> <span class="n">sim</span><span class="p">[</span><span class="nb">slice</span><span class="p">]</span> <span class="c1"># -&gt; new SimSnap object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sim</span><span class="p">[</span><span class="nb">slice</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sim</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="nb">slice</span><span class="p">]</span> <span class="c1"># -&gt; True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">subsim</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sim</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="nb">slice</span><span class="p">]</span> <span class="c1"># -&gt; True</span>
</pre></div>
</div>
<p><cite>slice</cite> here can literally be a python slice (e.g. <cite>sim[22:73:2]</cite>,
starting at the 22nd particle, finishing at the 72nd, taking every
second particle). It can also be a list of particle indices.</p>
<p>Or, more interestingly, it can be a <cite>filter</cite>. More on that below, but first…</p>
</div>
<div class="section" id="conceptually-everything-is-a-pointer">
<h2>Conceptually, everything is a pointer<a class="headerlink" href="#conceptually-everything-is-a-pointer" title="Permalink to this headline">¶</a></h2>
<p>Whenever you create a sub-view of your simulation, you should think of
it as a _pointer_ into, not a copy of, the original data.</p>
<p>Thus changing anything in the arrays of your sub-view makes the
corresponding change in the full data.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">subsim</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">22</span>
</pre></div>
</div>
<p>You can verify that the corresponding element of <cite>sim[‘x’]</cite> has now changed</p>
</div>
<div class="section" id="filters">
<h2>Filters<a class="headerlink" href="#filters" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../reference/convenience.html#module-pynbody.filt" title="pynbody.filt"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pynbody.filt</span></code></a> defines abstract filters which can be used in place of
index lists. For instance,</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">radius</span> <span class="o">=</span> <span class="s2">&quot;1 kpc&quot;</span> <span class="c1"># or might be a float if you already know your units</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">centre</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># Take the origin for now</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sphere</span> <span class="o">=</span> <span class="n">sub</span><span class="p">[</span><span class="n">pynbody</span><span class="o">.</span><span class="n">filt</span><span class="o">.</span><span class="n">Sphere</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">centre</span><span class="p">)]</span>
</pre></div>
</div>
<p><cite>sphere</cite> is now a standard subsim, as though you’d generated it with
your own index list.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sphere</span><span class="p">[</span><span class="s2">&quot;mass&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="c1"># -&gt; total mass in sphere</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sphere</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]</span> <span class="c1"># etc</span>
</pre></div>
</div>
<p>Under the hood, filters are very simple objects which have a
<cite>__call__</cite> method taking a simulation as the sole parameter, and
returning a boolean array representing whether particles are included
(<cite>True</cite>) or excluded (<cite>False</cite>) according to the given filter
object. The framework uses this to generate an index list and proceeds
as though you’d passed that index list in.</p>
<p>The benefits that this brings are:</p>
<blockquote>
<div><ul class="simple">
<li><p>Code clarity</p></li>
<li><p>Code factorization (guaranteed that the ‘sphere’ filter works,
rather than having to recode a sphere index-list operation each
time)</p></li>
<li><p>Future extensibility (e.g. we can just start having Sphere’s
accept quantities with units, rather than having to reimplement to
include units in all code which pulls out spheres)</p></li>
<li><p>Parallelizability (the ‘filter’ objects can be trivially sent to
another node, whereas an index list is irrelevant on another node)</p></li>
</ul>
</div></blockquote>
<p>Filters can be combined using the following operators, which can of course be chained together:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 78%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Operator</strong></p></th>
<th class="head"><p><strong>Particle included if</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>f1 &amp; f2</cite></p></td>
<td><p>Filters <cite>f1</cite> and <cite>f2</cite> both include particle</p></td>
</tr>
<tr class="row-odd"><td><p><cite>f1 | f2</cite></p></td>
<td><p>Filter <cite>f1</cite> OR <cite>f2</cite> includes particle</p></td>
</tr>
<tr class="row-even"><td><p><cite>~f</cite></p></td>
<td><p>Filter <cite>f</cite> does NOT include particle</p></td>
</tr>
</tbody>
</table>
<p>There are several filter classes currently implemented. Generic filter
classes work like band-pass filters and are conveniently named so. For example,</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">young</span> <span class="o">=</span> <span class="n">pynbody</span><span class="o">.</span><span class="n">filt</span><span class="o">.</span><span class="n">LowPass</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;1 Gyr&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">old</span> <span class="o">=</span> <span class="n">pynbody</span><span class="o">.</span><span class="n">filt</span><span class="o">.</span><span class="n">HighPass</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;10 Gyr&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">intermediate</span> <span class="o">=</span> <span class="n">pynbody</span><span class="o">.</span><span class="n">filt</span><span class="o">.</span><span class="n">BandPass</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;3 Gyr&#39;</span><span class="p">,</span> <span class="s1">&#39;7 Gyr&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>would create three filters that each select particles with different
value ranges for the <cite>age</cite> array.</p>
<p>Additionaly, several “geometric” filter classes are available. We
already saw <a class="reference internal" href="../reference/convenience.html#pynbody.filt.Sphere" title="pynbody.filt.Sphere"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sphere</span></code></a> used above, but
<a class="reference internal" href="../reference/convenience.html#pynbody.filt.Disc" title="pynbody.filt.Disc"><code class="xref py py-class docutils literal notranslate"><span class="pre">Disc</span></code></a>, <a class="reference internal" href="../reference/convenience.html#pynbody.filt.Cuboid" title="pynbody.filt.Cuboid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cuboid</span></code></a>, and two
convenience functions <a class="reference internal" href="../reference/convenience.html#pynbody.filt.SolarNeighborhood" title="pynbody.filt.SolarNeighborhood"><code class="xref py py-func docutils literal notranslate"><span class="pre">SolarNeighborhood()</span></code></a> and
<a class="reference internal" href="../reference/convenience.html#pynbody.filt.Annulus" title="pynbody.filt.Annulus"><code class="xref py py-func docutils literal notranslate"><span class="pre">Annulus()</span></code></a> are also available.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo.svg" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials &amp; walkthroughs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="tutorials.html">Pynbody Tutorials</a><ul>
      <li>Previous: <a href="data_access.html" title="previous chapter">A walk through pynbody’s low-level facilities</a></li>
      <li>Next: <a href="bridge.html" title="next chapter">Tracing Particles between Snapshots</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2011-20, pynbody team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/tutorials/filters.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>